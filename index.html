<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="author" content="AquaCheese">
        <meta name="viewport" content="width=device-width, initial-scale= 1.0">
        <title>AquaCheese Photography - home</title>
        <link rel="icon" href="AquaCheese  Logo.png">
        
        <style>
    body {
        background-color: #2c2c2c;
        color: #f5f5f5;
        font-family: Arial, Helvetica, sans-serif;
        margin: 0;
        padding: 0;
        text-align: center;
    }

    a {
        color: #ffcc00;
        text-decoration: none;
    }

    a:visited {
        color: #ffa500;
    }

    a:hover {
        color: #ffffff;
    }

    a:active {
        color: #ffcc00;
    }

    /* Button Styles */
    button {
        font-size: 16px;
        border-radius: 8px;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    button:hover {
        transform: scale(1.05);
    }

    .btncontact {
        background-color: #007bff;
        color: white;
    }

    .btncontact:hover {
        background-color: #0056b3;
    }

    .btnYT {
        background-color: #dc3545;
        color: white;
    }

    .btnYT:hover {
        background-color: #a71d2a;
    }

    .btnabt {
        background-color: #28a745;
        color: white;
    }

    .btnabt:hover {
        background-color: #1e7e34;
    }

    .btnrec {
        background-color: #ffc107;
        color: black;
    }

    .btnrec:hover {
        background-color: #e0a800;
    }

    .btnall {
        background-color: #17a2b8;
        color: white;
    }

    .btnall:hover {
        background-color: #117a8b;
    }

    .btnvids {
        background-color: #6f42c1;
        color: white;
    }

    .btnvids:hover {
        background-color: #563d7c;
    }

    .btnback {
        background-color: #343a40;
        color: white;
    }

    .btnback:hover {
        background-color: #23272b;
    }

    .btn_search {
        background-color: #ffc107;
        color: black;
        border: none;
        padding: 10px;
        font-size: 16px;
        border-radius: 8px;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .btn_search:hover {
        background-color: #e0a800;
        transform: scale(1.05);
    }

    /* Fieldset and Image Styles */
    fieldset {
        border: 1px solid #444;
        border-radius: 8px;
        padding: 20px;
        margin: 20px auto;
        background-color: #3a3a3a;
        color: #f5f5f5;
        max-width: 90%;
    }

    legend {
        font-size: 1.2rem;
        font-weight: bold;
        color: #ffcc00;
    }

    img {
        border-radius: 8px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    img:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
    }

    /* Cart Panel */
    #cartPanel {
        background-color: #444;
        color: #f5f5f5;
        border-left: 2px solid #ffcc00;
    }

    #cartPanel h2 {
        color: #ffcc00;
    }

    #cartPanel ul li {
        border-bottom: 1px solid #555;
    }

    #closeCart {
        background-color: #dc3545;
    }

    #closeCart:hover {
        background-color: #a71d2a;
    }

    /* Login Modal */
    #loginModal {
        background-color: rgba(0, 0, 0, 0.8);
    }

    #loginModal div {
        background-color: #444;
    }

    #googleLoginButton {
        background-color: #4285F4;
    }

    #googleLoginButton:hover {
        background-color: #357ae8;
    }

    #emailLoginButton {
        background-color: #555;
    }

    #emailLoginButton:hover {
        background-color: #333;
    }

    #closeLoginModal {
        background-color: #dc3545;
    }

    #closeLoginModal:hover {
        background-color: #a71d2a;
    }

    #loginModal form {
        border: none !important;
        background: none !important;
        box-shadow: none !important;
        margin: 0 auto !important;
        padding: 0 !important;
        width: 90% !important;
        display: flex !important;
        flex-direction: column !important;
        align-items: center !important;
    }

    /* Hide the horizontal rule in the login modal */
    #loginModal hr {
      display: none !important;
    }

    #loginModal form[style*="display:none"] {
        display: none !important;
    }

    #loginModal .hidden { display: none !important; }

    /* Responsive Design */
    @media (max-width: 768px) {
        body {
            font-size: 14px;
        }

        fieldset {
            padding: 10px;
        }

        img {
            width: 100%;
            height: auto;
        }

        button {
            font-size: 14px;
            padding: 8px 16px;
        }
    }
    html{
        scroll-behavior: smooth;
    }

    /* Add to your <style> section */
/* Custom Animated Dropdown Styles */
.dropdown-animated-container {
  display: inline-block;
}

.dropdown-label {
  color: #ffcc00;
  font-weight: bold;
  margin-right: 8px;
  font-size: 1.1em;
  letter-spacing: 1px;
}

.dropdown-animated-wrapper {
  display: inline-block;
  position: relative;
}

.dropdown-animated-select {
  padding: 10px 40px 10px 16px;
  border-radius: 10px;
  border: 2px solid #ffcc00;
  background: #232323;
  color: #ffcc00;
  font-size: 1.1em;
  box-shadow: 0 2px 12px rgba(0,0,0,0.25);
  outline: none;
  transition: 
    border-color 0.3s,
    box-shadow 0.3s,
    background 0.3s,
    color 0.3s,
    transform 0.25s cubic-bezier(.4,2,.6,1);
  appearance: none;
  cursor: pointer;
  min-width: 210px;
  text-align: left;
  position: relative;
}

.dropdown-animated-select:focus,
.dropdown-animated-select:hover {
  border-color: #ffd700;
  box-shadow: 0 0 8px 2px #ffcc00aa;
  background: #2c2c2c;
  color: #fffbe6;
  transform: scale(1.04);
}

.dropdown-arrow {
  position: absolute;
  right: 18px;
  top: 50%;
  width: 0;
  height: 0;
  border-left: 7px solid transparent;
  border-right: 7px solid transparent;
  border-top: 7px solid #ffcc00;
  transform: translateY(-50%);
  pointer-events: none;
}

/* Dropdown List Animation */
.dropdown-list {
  position: absolute;
  left: 0;
  right: 0;
  top: 110%;
  background: #232323;
  border: 2px solid #ffcc00;
  border-radius: 10px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.4);
  margin: 0;
  padding: 0;
  list-style: none;
  opacity: 0;
  pointer-events: none;
  transform: translateY(-10px) scaleY(0.95);
  transition: opacity 0.25s, transform 0.25s cubic-bezier(.4,2,.6,1), max-height 0.3s;
  z-index: 100;
  max-height: 0;
  overflow: hidden;
}

.dropdown-list.open {
  opacity: 1;
  pointer-events: auto;
  transform: translateY(0) scaleY(1);
  max-height: 400px;
}

.dropdown-list li {
  padding: 12px 18px;
  color: #ffcc00;
  cursor: pointer;
  font-size: 1.05em;
  transition: background-color 0.2s;
}

.dropdown-list li:hover,
.dropdown-list li:focus {
  background: #2c2c2c;
  color: #fffbe6;
  outline: none;
}

/* Stack modal buttons vertically and center them */
#loginModal button {
  display: block;
  width: 90%;
  margin: 10px auto;
}

.hidden { display: none !important; }
</style>



    </head>
    <body> 
        <!-- DEBUG: Top of <body> loaded -->
<script>
console.log('DEBUG: <body> loaded');
</script>

        <b><h1 style="font-size: xxx-large;">Photography & Videography</h1></b>
        <br>
        <b style="font-size: xx-large;">[OPEN BETA]</b>
        <br><br>
        <span>v. 0.9.9</span>
        <br>
        <br>
        <span>THIS SITE IS IDEALLY VIEWED ON DESKTOP / LAPTOP <br> (viewing on other devices may lead to alignment, or other visual issues)</span>
        <br><br>
        <div style="font-size: large; margin-bottom: 18px;">
            <span>Images will load very slowly with a bad connection</span><br><br>
            <span id="imgHeightInfo">All image heights have been resized to 200 <abbr title="Pixels">px</abbr> for ✨viewing ease✨ (the real dimentions may differ)</span><br><br>
            <span>(all image formats are JPG (except the watermarked photos))</span><br><br>
            <span id='deviceWarningSpan'>(viewing on other devices may lead to alignment, or other visual issues)</span><br><br>
            <h3 style="margin: 10px 0 0 0;"><u><b>PURCHASING ANY IMAGE WILL NOT WORK!</b></u></h3>
            <br>
            <span>(almost) ALL images on or associated with this site were taken / created by AquaCheese</span>
        </div>
        <hr>
        <a href="Contact Me Form.html"><button class="btncontact" style="font-size: 16px; text-align: center; border-radius: 12px;">Contact Me</button></a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="https://www.youtube.com/@aquacheese1" target="_blank" style="vertical-align: middle;">
  <img src="2-21145_youtube-logo-transparent-png-pictures-transparent-background-youtube.png" alt="YouTube" style="height:48px; width:auto; border-radius:12px; vertical-align:middle; box-shadow:0 2px 8px rgba(0,0,0,0.2);">
</a> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="About.html"><button class="btnabt" style="font-size: 16px; text-align: center; border-radius: 12px;">About</button></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="aquacheese.github.io/POTato"><button>POTATO GAME</button></a>
<br><br><br><br>
        <!-- Sections Dropdown Menu -->
        <div class="dropdown-animated-container" style="margin-bottom: 30px;">
  <label for="customDropdown" class="dropdown-label">catagories:</label>
  <div class="dropdown-animated-wrapper">
    <button id="customDropdown" class="dropdown-animated-select" aria-haspopup="listbox" aria-expanded="false" type="button">
      <span>Go to catagory...</span>
      <span class="dropdown-arrow"></span>
    </button>
    <ul id="dropdownList" class="dropdown-list" tabindex="-1" role="listbox" aria-labelledby="customDropdown">
      <li role="option" data-value="land">Landscape Images</li>
      <li role="option" data-value="port">Portrait Images</li>
      <li role="option" data-value="All">All Images</li>
      <li role="option" data-value="videos">Videos</li>
    </ul>
  </div>
</div>
        <script>

        document.addEventListener('DOMContentLoaded', () => {
  const dropdownBtn = document.getElementById('customDropdown');
  const dropdownList = document.getElementById('dropdownList');
  let isOpen = false;

  function openDropdown() {
    dropdownList.classList.add('open');
    dropdownBtn.setAttribute('aria-expanded', 'true');
    isOpen = true;
    // Focus first item for accessibility
    setTimeout(() => {
      dropdownList.querySelector('li').focus();
    }, 100);
  }

  function closeDropdown() {
    dropdownList.classList.remove('open');
    dropdownBtn.setAttribute('aria-expanded', 'false');
    isOpen = false;
  }

  dropdownBtn.addEventListener('click', (e) => {
    e.stopPropagation();
    isOpen ? closeDropdown() : openDropdown();
  });

  dropdownBtn.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      openDropdown();
    }
  });

  dropdownList.addEventListener('click', (e) => {
  if (e.target.matches('li')) {
    dropdownBtn.innerHTML = e.target.textContent + '<span class="dropdown-arrow"></span>';
    closeDropdown();
    // Redirect to section page instead of scrolling
    const val = e.target.getAttribute('data-value');
    if (val) {
      let page = '';
      switch(val) {
        case 'land':
          page = 'landscape.html';
          break;
        case 'port':
          page = 'portrait.html';
          break;
        case 'All':
          page = 'all imgs.html';
          break;
        case 'videos':
          page = 'videos.html';
          break;
      }
      if (page) {
        window.location.href = page;
      }
    }
  }
});

  // Keyboard navigation for dropdown list
  dropdownList.addEventListener('keydown', (e) => {
    const items = Array.from(dropdownList.querySelectorAll('li'));
    let idx = items.indexOf(document.activeElement);
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      items[(idx + 1) % items.length].focus();
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      items[(idx - 1 + items.length) % items.length].focus();
    } else if (e.key === 'Escape') {
      closeDropdown();
      dropdownBtn.focus();
    } else if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      document.activeElement.click();
    }
  });

  // Close dropdown when clicking outside
  document.addEventListener('click', (e) => {
    if (!dropdownBtn.contains(e.target) && !dropdownList.contains(e.target)) {
      closeDropdown();
    }
  });
});
        </script>

        <hr>
        <button id="mobileViewButton" style="font-size: large; margin: 20px; padding: 10px; border-radius: 5px; background-color: lightblue; border: none; cursor: pointer;">
    Tap if you're on mobile
    </button>

    <script>
        document.getElementById('mobileViewButton').addEventListener('click', function () {
            document.body.style.fontSize = '14px'; // Adjust font size for mobile
            document.body.style.padding = '10px'; // Add padding for better spacing
            const fieldsets = document.querySelectorAll('fieldset');
            fieldsets.forEach(fieldset => {
                fieldset.style.width = '100%'; // Make fieldsets take full width
                fieldset.style.margin = '10px auto'; // Center fieldsets with margin
            });
            const images = document.querySelectorAll('img');
            images.forEach(img => {
                img.style.width = '100%'; // Make images responsive
                img.style.height = 'auto'; // Maintain aspect ratio
            });
            const videos = document.querySelectorAll('video');
            videos.forEach(video => {
                video.style.width = '100%'; // Make videos responsive
                video.style.height = 'auto'; // Maintain aspect ratio
            });
            const videoFieldsets = document.querySelectorAll('#videos fieldset');
            videoFieldsets.forEach(videoFieldset => {
                videoFieldset.style.width = '100%'; // Make video fieldsets responsive
                videoFieldset.style.margin = '10px auto'; // Center video fieldsets
            });
        });
    </script>

    <hr>
    <!-- Featured Images Section (restored) -->
<h2 style="color: #ffcc00; margin-top: 40px;">3 Featured Images</h2>
<div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 32px; margin: 30px auto 40px auto; max-width: 1400px;">
  <div style="background: #3a3a3a; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.25); padding: 18px 18px 12px 18px; width: 320px; max-width: 95vw; text-align: center;">
    <a href="Seagull car img.html"><img src="Seagull on a Car WM.png" alt="Seagull on a Car" style="width: 100%; height: auto; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.18); background: #232323;"></a>
    <div style="color: #ffcc00; font-size: 1.15rem; font-weight: bold; margin-bottom: 6px;">Seagull on a Car</div>
    <div style="color: #fff; margin-bottom: 8px;">£15</div>
    <button type="button" style="background-color:#ffc107;color:black;margin-top:8px;" onclick="addToCart('Seagull on a Car', 'Seagull on a Car WM.png')">Add to Cart</button>
  </div>
  <div style="background: #3a3a3a; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.25); padding: 18px 18px 12px 18px; width: 320px; max-width: 95vw; text-align: center;">
    <a href="Gavel.html"><img src="Gavel WM.png" alt="Gavel" style="width: 100%; height: auto; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.18); background: #232323;"></a>
    <div style="color: #ffcc00; font-size: 1.15rem; font-weight: bold; margin-bottom: 6px;">Gavel</div>
    <div style="color: #fff; margin-bottom: 8px;">£15</div>
    <button type="button" style="background-color:#ffc107;color:black;margin-top:8px;" onclick="addToCart('Gavel', 'Gavel WM.png')">Add to Cart</button>
  </div>
  <div style="background: #3a3a3a; border-radius: 12px; box-shadow: 0 4px 16px rgba(0,0,0,0.25); padding: 18px 18px 12px 18px; width: 320px; max-width: 95vw; text-align: center;">
    <a href="flowers.html"><img src="flowers WM.png" alt="Flowers" style="width: 100%; height: auto; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.18); background: #232323;"></a>
    <div style="color: #ffcc00; font-size: 1.15rem; font-weight: bold; margin-bottom: 6px;">Flowers</div>
    <div style="color: #fff; margin-bottom: 8px;">£15</div>
    <button type="button" style="background-color:#ffc107;color:black;margin-top:8px;" onclick="addToCart('Flowers', 'flowers WM.png')">Add to Cart</button>
  </div>
</div>
<!-- End Featured Images -->
        <br>
        <!-- Remove the second mobile button and the bottom info message -->

   <!-- Cart button -->
<button id="cartButton" style="position: fixed; top: 20px; right: 20px; background-color: gold; color: black; border: none; border-radius: 12px; padding: 10px 20px; font-size: 16px; cursor: pointer; z-index: 1000; transition: background-color 0.3s;">Cart</button>

<!-- Cart panel -->
<div id="cartPanel" style="position: fixed; top: 0; right: -100%; width: 300px; height: 100%; background-color: #333; color: whitesmoke; box-shadow: -2px 0 5px rgba(0,0,0,0.5); overflow-y: auto; transition: right 0.3s ease; z-index: 999; padding: 20px; display: block;">
    <button id="closeCart" style="position: absolute; top: 10px; right: 10px; background-color: red; color: white; border: none; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1001;">&times;</button>
    <h2 style="text-align: center; color: #ffcc00;">Your Cart</h2>
    <ul id="cartList" style="list-style-type: none; padding: 0;"></ul>
    <div id="cartSubtotal" style="margin-top: 20px; font-size: 18px; text-align: center; border-top: 1px solid whitesmoke; padding-top: 10px;">Subtotal: £0</div>
    <button id="buyNowButton" style="margin-top: 20px; width: 100%; padding: 10px 20px; background-color: green; color: white; border: none; border-radius: 5px; font-size: 16px; cursor: pointer;">Buy Now</button>
</div>

<div style="position: fixed; top: 20px; left: 20px; z-index: 1000; display: flex; align-items: center; gap: 12px;">
  <button id="loginButton" style="background-color: lightblue; color: black; border: none; border-radius: 12px; padding: 10px 20px; font-size: 16px; cursor: pointer;">
    Log In
  </button>
  <img id="profilePic" src="" alt="Profile" style="display:none;width:48px;height:48px;border-radius:50%;margin-left:0px;vertical-align:middle;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,0.2);background:#eee;object-fit:cover;">
</div>

<div id="loginModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000;">
  <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #333; color: whitesmoke; padding: 20px; border-radius: 8px; width: 300px; text-align: center;">
    <h2>Log In</h2>
    <button id="googleLoginButton" style="background-color: #4285F4; color: white; border: none; border-radius: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px;">Log In with Google</button>
    <button id="showEmailLoginForm" style="background-color: #555; color: white; border: none; border-radius: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px;">Log In with Email</button>
    <button id="showRegisterForm" style="background-color: #ffc107; color: black; border: none; border-radius: 5px; padding: 8px 16px; font-size: 15px; cursor: pointer; margin: 10px; display: inline-block;">Register</button>
    <form id="emailLoginForm" class="hidden" style="margin-top:10px;">
      <input id="emailInput" type="email" placeholder="Email" required style="width:90%;margin-bottom:8px;padding:8px;border-radius:5px;border:none;">
      <input id="passwordInput" type="password" placeholder="Password" required style="width:90%;margin-bottom:8px;padding:8px;border-radius:5px;border:none;">
      <button type="submit" style="background-color: #555; color: white; border: none; border-radius: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px;">Log In</button>
      <button type="button" id="cancelEmailLogin" style="background-color: #dc3545; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-size: 15px; cursor: pointer; margin: 10px;">Cancel</button>
    </form>
    <form id="registerForm" class="hidden" style="margin-top:10px;">
      <input id="registerEmail" type="email" placeholder="Email" required style="width:90%;margin-bottom:8px;padding:8px;border-radius:5px;border:none;">
      <input id="registerPassword" type="password" placeholder="Password" required style="width:90%;margin-bottom:8px;padding:8px;border-radius:5px;border:none;">
      <button type="submit" style="background-color: #28a745; color: white; border: none; border-radius: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px;">Register</button>
      <button type="button" id="cancelRegister" style="background-color: #dc3545; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-size: 15px; cursor: pointer; margin: 10px;">Cancel</button>
    </form>
    <div id="emailLoginError" style="color:#ff6666; margin-top:8px; min-height:20px;"></div>
    <br>
    <hr style="border: 0; border-top: 1px solid #888; margin: 16px 0 8px 0;">
    <button id="closeLoginModal" style="background-color: red; color: white; border: none; border-radius: 5px; padding: 5px 10px; font-size: 14px; cursor: pointer; margin-top: 10px;">Close</button>
    <button id="logoutButton" style="background-color: #343a40; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-size: 15px; cursor: pointer; margin: 10px; display: none;">Log Out</button>
  </div>
</div>

<div id="profileMenu" style="display:none; position:fixed; top:70px; left:20px; background:#444; color:#fff; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,0.3); z-index:2000; min-width:140px; padding:16px 12px;">
    <button id="profileMenuLogoutButton" style="background-color: #dc3545; color: white; border: none; border-radius: 5px; padding: 10px 20px; font-size: 16px; cursor: pointer;">Logout</button>
</div>

    <!-- Move all Firebase and login modal scripts to the very end of body -->
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-app-compat.js"></script>
    <!-- Firebase Auth -->
    <script src="https://www.gstatic.com/firebasejs/9.6.11/firebase-auth-compat.js"></script>
    <!-- Your custom Firebase config -->
    <script src="firebase-config.js"></script>
    <script>
    // DEBUG: Firebase initialization script running
    console.log('DEBUG: Firebase initialization script running');
    // Initialize Firebase
    if (!window._firebaseInitialized && window.firebase && window.firebaseConfig) {
      firebase.initializeApp(firebaseConfig);
      window._firebaseInitialized = true;
    }
    </script>
    <script>
// --- LOGIN MODAL LOGIC: Always enable modal UI, only require Firebase for login actions ---
(function setupLoginModalUI() {
  const loginButton = document.getElementById('loginButton');
  const loginModal = document.getElementById('loginModal');
  const closeLoginModal = document.getElementById('closeLoginModal');
  const googleLoginButton = document.getElementById('googleLoginButton');
  const showEmailLoginFormBtn = document.getElementById('showEmailLoginForm');
  const showRegisterFormBtn = document.getElementById('showRegisterForm');
  const emailLoginForm = document.getElementById('emailLoginForm');
  const registerForm = document.getElementById('registerForm');
  const cancelEmailLoginBtn = document.getElementById('cancelEmailLogin');
  const cancelRegisterBtn = document.getElementById('cancelRegister');
  const emailInput = document.getElementById('emailInput');
  const passwordInput = document.getElementById('passwordInput');
  const emailLoginError = document.getElementById('emailLoginError');
  const logoutButton = document.getElementById('logoutButton');
  const profilePic = document.getElementById('profilePic');
  const profileMenu = document.getElementById('profileMenu');
  const profileMenuLogoutButton = document.getElementById('profileMenuLogoutButton');
  function show(el) { el.classList.remove('hidden'); }
  function hide(el) { el.classList.add('hidden'); }
  function resetLoginModal() {
    hide(emailLoginForm);
    hide(registerForm);
    show(googleLoginButton);
    show(showEmailLoginFormBtn);
    show(showRegisterFormBtn);
    emailLoginError.textContent = '';
    if (typeof emailLoginForm.reset === 'function') emailLoginForm.reset();
    if (typeof registerForm.reset === 'function') registerForm.reset();
  }
  if (loginButton) {
    loginButton.addEventListener('click', () => {
      resetLoginModal();
      loginModal.style.display = 'block';
      loginModal.style.zIndex = '9999';
      loginModal.style.backgroundColor = 'rgba(0,0,0,0.5)';
      if (loginModal.firstElementChild) {
        loginModal.firstElementChild.style.backgroundColor = '#333';
        loginModal.firstElementChild.style.color = 'whitesmoke';
        loginModal.firstElementChild.style.border = '';
      }
      const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
      if (loggedInUser) {
        logoutButton.style.display = 'block';
      } else {
        logoutButton.style.display = 'none';
      }
    });
  }
  if (closeLoginModal) {
    closeLoginModal.addEventListener('click', () => {
      loginModal.style.display = 'none';
      resetLoginModal();
    });
  }
  if (showEmailLoginFormBtn) {
    showEmailLoginFormBtn.addEventListener('click', () => {
      hide(googleLoginButton);
      hide(showEmailLoginFormBtn);
      hide(showRegisterFormBtn);
      show(emailLoginForm);
      hide(registerForm);
      emailLoginError.textContent = '';
      if (typeof emailLoginForm.reset === 'function') emailLoginForm.reset();
    });
  }
  if (cancelEmailLoginBtn) {
    cancelEmailLoginBtn.addEventListener('click', () => {
      show(googleLoginButton);
      hide(emailLoginForm);
      show(showEmailLoginFormBtn);
      show(showRegisterFormBtn);
      emailLoginError.textContent = '';
      if (typeof emailLoginForm.reset === 'function') emailLoginForm.reset();
    });
  }
  if (showRegisterFormBtn) {
    showRegisterFormBtn.addEventListener('click', () => {
      hide(googleLoginButton);
      hide(showEmailLoginFormBtn);
      hide(showRegisterFormBtn);
      hide(emailLoginForm);
      show(registerForm);
      emailLoginError.textContent = '';
      if (typeof registerForm.reset === 'function') registerForm.reset();
    });
  }
  if (cancelRegisterBtn) {
    cancelRegisterBtn.addEventListener('click', () => {
      show(googleLoginButton);
      hide(registerForm);
      show(showEmailLoginFormBtn);
      show(showRegisterFormBtn);
      emailLoginError.textContent = '';
      if (typeof registerForm.reset === 'function') registerForm.reset();
    });
  }
})();
// --- END LOGIN MODAL UI LOGIC ---

// --- LOGIN/REGISTER ACTIONS: Only require Firebase for actual login/register ---
(function waitForFirebaseAndRun(attempts = 0) {
  if (!(window.firebase && window.firebaseConfig && window._firebaseInitialized)) {
    if (attempts === 0) {
      console.warn('Waiting for Firebase to be ready...');
    }
    if (attempts > 100) {
      console.error('ERROR: Firebase config or initialization not detected after 5 seconds.');
      // Show error for login/register actions
      const emailLoginError = document.getElementById('emailLoginError');
      if (emailLoginError) emailLoginError.textContent = 'Login/register is currently unavailable.';
      // Disable login/register buttons
      const googleLoginButton = document.getElementById('googleLoginButton');
      const showEmailLoginFormBtn = document.getElementById('showEmailLoginForm');
      const showRegisterFormBtn = document.getElementById('showRegisterForm');
      if (googleLoginButton) googleLoginButton.disabled = true;
      if (showEmailLoginFormBtn) showEmailLoginFormBtn.disabled = true;
      if (showRegisterFormBtn) showRegisterFormBtn.disabled = true;
      return;
    }
    setTimeout(() => waitForFirebaseAndRun(attempts + 1), 50);
    return;
  }
  const googleLoginButton = document.getElementById('googleLoginButton');
  const emailLoginForm = document.getElementById('emailLoginForm');
  const registerForm = document.getElementById('registerForm');
  const emailLoginError = document.getElementById('emailLoginError');
  const logoutButton = document.getElementById('logoutButton');
  const profilePic = document.getElementById('profilePic');
  const profileMenu = document.getElementById('profileMenu');
  const profileMenuLogoutButton = document.getElementById('profileMenuLogoutButton');
  const emailInput = document.getElementById('emailInput');
  const passwordInput = document.getElementById('passwordInput');
  const showEmailLoginFormBtn = document.getElementById('showEmailLoginForm');
  const showRegisterFormBtn = document.getElementById('showRegisterForm');
  if (!googleLoginButton || !emailLoginForm || !registerForm || !emailLoginError || !logoutButton || !profileMenuLogoutButton) return;
  const auth = firebase.auth();
  const googleProvider = new firebase.auth.GoogleAuthProvider();
  function updateProfileUI() {
    const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
    if (loggedInUser && profilePic) {
      profilePic.src = loggedInUser.profilePicUrl || 'default-profile.png';
      profilePic.style.display = 'inline-block';
      const loginButton = document.getElementById('loginButton');
      if (loginButton) loginButton.style.display = 'none';
      if (profileMenu) profileMenu.style.display = 'none';
    } else {
      if (profilePic) profilePic.style.display = 'none';
      const loginButton = document.getElementById('loginButton');
      if (loginButton) loginButton.style.display = 'inline-block';
      if (profileMenu) profileMenu.style.display = 'none';
    }
  }
  googleLoginButton.addEventListener('click', () => {
    auth.signInWithPopup(googleProvider)
      .then((result) => {
        const user = result.user;
        localStorage.setItem('loggedInUser', JSON.stringify({
          displayName: user.displayName || user.email,
          profilePicUrl: user.photoURL,
          email: user.email
        }));
        document.getElementById('loginModal').style.display = 'none';
        updateProfileUI();
      })
      .catch((error) => {
        emailLoginError.textContent = 'Google Login Failed: ' + error.message;
      });
  });
  emailLoginForm.addEventListener('submit', function(e) {
    e.preventDefault();
    emailLoginError.textContent = '';
    const email = emailInput.value.trim();
    const password = passwordInput.value;
    auth.signInWithEmailAndPassword(email, password)
      .then((result) => {
        const user = result.user;
        localStorage.setItem('loggedInUser', JSON.stringify({
          displayName: user.displayName || user.email,
          profilePicUrl: user.photoURL,
          email: user.email
        }));
        document.getElementById('loginModal').style.display = 'none';
        updateProfileUI();
      })
      .catch((error) => {
        emailLoginError.textContent = error.message.replace('Firebase: ', '');
      });
  });
  registerForm.addEventListener('submit', function(e) {
    e.preventDefault();
    emailLoginError.textContent = '';
    const email = document.getElementById('registerEmail').value.trim();
    const password = document.getElementById('registerPassword').value;
    auth.createUserWithEmailAndPassword(email, password)
      .then((result) => {
        const user = result.user;
        localStorage.setItem('loggedInUser', JSON.stringify({
          displayName: user.displayName || user.email,
          profilePicUrl: user.photoURL,
          email: user.email
        }));
        document.getElementById('loginModal').style.display = 'none';
        updateProfileUI();
      })
      .catch((error) => {
        emailLoginError.textContent = error.message.replace('Firebase: ', '');
      });
  });
  function robustLogout() {
    localStorage.removeItem('loggedInUser');
    if (window.firebase && firebase.auth) {
      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.NONE).then(() => {
        sessionStorage.setItem('justLoggedOut', '1');
        return firebase.auth().signOut();
      }).then(() => {
        window.location.reload();
      });
    } else {
      window.location.reload();
    }
  }
  profileMenuLogoutButton.addEventListener('click', robustLogout);
  logoutButton.addEventListener('click', robustLogout);
  if (profilePic && profileMenu) {
    profilePic.addEventListener('click', (e) => {
      e.stopPropagation();
      profileMenu.style.display = profileMenu.style.display === 'block' ? 'none' : 'block';
    });
    document.addEventListener('click', (e) => {
      if (profileMenu.style.display === 'block' && !profileMenu.contains(e.target) && e.target !== profilePic) {
        profileMenu.style.display = 'none';
      }
    });
  }
  profileMenuLogoutButton.addEventListener('click', () => {
    localStorage.removeItem('loggedInUser');
    window.location.reload();
  });
  if (sessionStorage.getItem('justLoggedOut')) {
    sessionStorage.removeItem('justLoggedOut');
    if (window.firebase && firebase.auth) firebase.auth().signOut();
    updateProfileUI();
    return;
  }
  const loggedInUser = JSON.parse(localStorage.getItem('loggedInUser'));
  if (loggedInUser) {
    updateProfileUI();
  } else {
    auth.onAuthStateChanged(function(user) {
      if (user) {
        localStorage.setItem('loggedInUser', JSON.stringify({
          displayName: user.displayName || user.email,
          profilePicUrl: user.photoURL,
          email: user.email
        }));
        updateProfileUI();
      } else {
        updateProfileUI();
      }
    });
  }
})();
    </script>
    </body>
    </html>
